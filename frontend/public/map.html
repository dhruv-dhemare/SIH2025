<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Alumni Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>
  <style>
    #map { height: 100vh; width: 100%; }
    .toggle-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: white;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <button class="toggle-btn" onclick="toggleView()">Switch View</button>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

  <script>
    // Initialize Map
    var map = L.map("map").setView([20.5937, 78.9629], 5); // Center India

    // Base Map (white OpenStreetMap)
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "Â© OpenStreetMap"
    }).addTo(map);

    // Cluster group
    var markers = L.markerClusterGroup({
      iconCreateFunction: function(cluster) {
        return L.divIcon({
          html: '<div style="background:#341539;color:white;border-radius:50%;width:30px;height:30px;line-height:30px;text-align:center;">' 
                 + cluster.getChildCount() + '</div>',
          className: 'custom-cluster',
          iconSize: [30, 30]
        });
      }
    });

    var heat; // heatmap layer reference
    var currentView = "cluster";

    // Fetch alumni data from backend
    fetch("http://localhost:5000/api/alumni")   // ðŸ‘ˆ adjust backend URL & port
      .then(res => res.json())
      .then(alumniData => {
        // Add markers
        alumniData.forEach(a => {
          if (a.lat && a.lng) {
            markers.addLayer(
              L.circleMarker([a.lat, a.lng], {
                radius: 6,
                color: "#341539",
                fillColor: "#341539",
                fillOpacity: 0.9
              }).bindPopup(`<b>${a.name}</b><br>Pincode: ${a.pincode}`)
            );
          }
        });

        // Heatmap
        var heatData = alumniData.map(a => [a.lat, a.lng, 1]);
        heat = L.heatLayer(heatData, { 
          radius: 40,
          blur: 25,
          minOpacity: 0.4,
          max: 2.0,
          gradient: {
            0.2: "blue",
            0.4: "purple",
            0.6: "red",
            0.8: "orange",
            1.0: "yellow"
          }
        });

        // Default: Cluster view
        map.addLayer(markers);
      })
      .catch(err => console.error("Error loading alumni data:", err));

    function toggleView() {
      if (currentView === "cluster") {
        if (map.hasLayer(markers)) map.removeLayer(markers);
        if (heat) map.addLayer(heat);
        currentView = "heat";
      } else {
        if (heat && map.hasLayer(heat)) map.removeLayer(heat);
        map.addLayer(markers);
        currentView = "cluster";
      }
    }
  </script>
</body>
</html>
